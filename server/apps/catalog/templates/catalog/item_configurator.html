{% extends 'base/base.html' %}

{% load static %}

{% block content %}
<div class="container-fluid">
  <div class="row d-flex flex-wrap">
      <div class="col-md-8 configurator-images">
          {% for img in item.images.all %}
              <canvas
                  id="canvas{{ img.id }}"
                  class="main-canvas"
                  data-img-url="{{ img.image.url }}"
                  style="{% if not forloop.first %}display:none;{% endif %} width: 100%; height: 400px;"
              ></canvas>
          {% endfor %}
          <div class="thumbnail-list-row d-flex justify-content-center mt-3">
              {% for img in item.images.all %}
                  <div class="thumbnail-item-row mx-1 {% if forloop.first %}active{% endif %}"
                      onclick="showCanvas('canvas{{ img.id }}', this)"
                      style="cursor:pointer; width: 60px;">
                      <img src="{{ img.image.url }}" alt="{{ item.name }}" class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover;">
                  </div>
              {% endfor %}
          </div>
      </div>
      <div class="col-md-4 configurator-form">
        <div class="accordion" id="galleryAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGallery" aria-expanded="false" aria-controls="collapseGallery"
                      hx-get="{% if request.user.is_authenticated %}{% url 'user:auth_user_gallery' %}{% else %}{% url 'user:session_user_gallery' %}{% endif %}"
                      hx-trigger="click once"
                      hx-target="#collapseGalleryBody"
              >
                Gallery
              </button>
            </h2>
            <div id="collapseGallery" class="accordion-collapse collapse" data-bs-parent="#galleryAccordion">
              <div class="accordion-body" id="collapseGalleryBody">

              </div>
            </div>
          </div>
        </div>

        <div id="loading-spinner" class="text-center" style="display: none;">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Generating your print...</p>
        </div>

        <form method="post" id="user_prompt_form">
            {% csrf_token %}
            <div class="mb-3">
            <label for="user_prompt" class="form-label">Prompt for print</label>
            <input type="text" id="user_prompt" name="user_prompt" class="form-control" placeholder="Enter your print prompt here...">
            </div>
            <button type="submit" class="btn btn-primary" id="submit-btn">Save</button>
        </form>

      </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
    <script src="https://cdn.jsdelivr.net/npm/print-edit-lib@latest/dist/PrintEditor.umd.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="{% static 'scripts/custom/item_configurator.js'%}"></script>
{% endblock %}
